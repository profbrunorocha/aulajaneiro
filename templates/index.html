<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Clientes</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .form { background: #f0f0f0; padding: 20px; margin-bottom: 20px; }
        .form input { margin: 5px; padding: 8px; width: 200px; }
        button { padding: 8px 15px; background: blue; color: white; border: none; cursor: pointer; margin-right: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
        th { background: #eee; }
        .btn-edit { background: orange; }
        .btn-delete { background: red; }
        .btn-update { background: green; }
        .btn-cancel { background: gray; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Cadastro de Clientes</h1>
    
    <div class="form">
        <input type="hidden" id="clienteId">
        <input type="text" id="nome" placeholder="Nome">
        <input type="email" id="email" placeholder="Email">
        <input type="text" id="telefone" placeholder="Telefone">
        
        <!-- Botão SALVAR - aparece apenas no modo NOVO -->
        <button id="btnSalvar" onclick="salvarNovoCliente()">Salvar</button>
        
        <!-- Botão ATUALIZAR - aparece apenas no modo EDIÇÃO -->
        <button id="btnAtualizar" class="btn-update hidden" onclick="atualizarCliente()">Atualizar</button>
        
        <button onclick="limparForm()" class="btn-cancel">Cancelar</button>
    </div>
    
    <table id="tabela">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Telefone</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // Carregar clientes ao abrir a página
        window.onload = carregarClientes;
        
        async function carregarClientes() {
            const response = await fetch('/clientes');
            const clientes = await response.json();
            
            const tbody = document.querySelector('#tabela tbody');
            tbody.innerHTML = '';
            
            clientes.forEach(cliente => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cliente.id}</td>
                    <td>${cliente.nome}</td>
                    <td>${cliente.email}</td>
                    <td>${cliente.telefone || ''}</td>
                    <td>
                        <button class="btn-edit" onclick="editarCliente(${cliente.id})">Editar</button>
                        <button class="btn-delete" onclick="excluirCliente(${cliente.id})">Excluir</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Função para SALVAR NOVO cliente (POST)
        async function salvarNovoCliente() {
            const cliente = {
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value
            };
            
            // Validação básica
            if (!cliente.nome || !cliente.email) {
                alert('Preencha Nome e Email!');
                return;
            }
            
            await fetch('/clientes', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(cliente)
            });
            
            limparForm();
            carregarClientes();
            alert('Cliente cadastrado com sucesso!');
        }
        
        // Função para ATUALIZAR cliente existente (PUT)
        async function atualizarCliente() {
            const id = document.getElementById('clienteId').value;
            const cliente = {
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value
            };
            
            // Validação básica
            if (!cliente.nome || !cliente.email) {
                alert('Preencha Nome e Email!');
                return;
            }
            
            await fetch(`/clientes/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(cliente)
            });
            
            limparForm();
            carregarClientes();
            alert('Cliente atualizado com sucesso!');
        }
        
        // Função para carregar dados do cliente no formulário (modo EDIÇÃO)
        async function editarCliente(id) {
            const response = await fetch('/clientes');
            const clientes = await response.json();
            const cliente = clientes.find(c => c.id === id);
            
            if (cliente) {
                // Preenche o formulário
                document.getElementById('clienteId').value = cliente.id;
                document.getElementById('nome').value = cliente.nome;
                document.getElementById('email').value = cliente.email;
                document.getElementById('telefone').value = cliente.telefone || '';
                
                // Muda para modo EDIÇÃO
                alternarModoEdicao(true);
            }
        }
        
        async function excluirCliente(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                await fetch(`/clientes/${id}`, {method: 'DELETE'});
                carregarClientes();
                alert('Cliente excluído com sucesso!');
            }
        }
        
        function limparForm() {
            document.getElementById('clienteId').value = '';
            document.getElementById('nome').value = '';
            document.getElementById('email').value = '';
            document.getElementById('telefone').value = '';
            
            // Volta para modo NOVO
            alternarModoEdicao(false);
        }
        
        // Função para alternar entre modo NOVO e modo EDIÇÃO
        function alternarModoEdicao(modoEdicao) {
            const btnSalvar = document.getElementById('btnSalvar');
            const btnAtualizar = document.getElementById('btnAtualizar');
            
            if (modoEdicao) {
                // Modo EDIÇÃO: esconde botão Salvar, mostra botão Atualizar
                btnSalvar.classList.add('hidden');
                btnAtualizar.classList.remove('hidden');
            } else {
                // Modo NOVO: mostra botão Salvar, esconde botão Atualizar
                btnSalvar.classList.remove('hidden');
                btnAtualizar.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
