<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Clientes</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .form { background: #f0f0f0; padding: 20px; margin-bottom: 20px; }
        .form input { margin: 5px; padding: 8px; width: 200px; }
        button { padding: 8px 15px; background: blue; color: white; border: none; cursor: pointer; margin-right: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
        th { background: #eee; }
        .btn-edit { background: orange; }
        .btn-delete { background: red; }
        .btn-update { background: green; }
        .btn-cancel { background: gray; }
        .hidden { display: none; }
        
        /* Estilos do Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 8px;
            width: 400px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            text-align: center;
            animation: slideDown 0.3s;
        }
        
        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .modal-body {
            font-size: 16px;
            margin-bottom: 20px;
            color: #666;
        }
        
        .modal-footer {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            min-width: 80px;
        }
        
        .modal-btn-ok {
            background: #4CAF50;
            color: white;
        }
        
        .modal-btn-ok:hover {
            background: #45a049;
        }
        
        .modal-btn-cancel {
            background: #f44336;
            color: white;
        }
        
        .modal-btn-cancel:hover {
            background: #da190b;
        }
        
        .modal-btn-neutral {
            background: #2196F3;
            color: white;
        }
        
        .modal-btn-neutral:hover {
            background: #0b7dda;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideDown {
            from { 
                transform: translateY(-50px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Ícones para o modal */
        .modal-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .modal-icon-success { color: #4CAF50; }
        .modal-icon-error { color: #f44336; }
        .modal-icon-warning { color: #ff9800; }
        .modal-icon-question { color: #2196F3; }
    </style>
</head>
<body>
    <h1>Cadastro de Clientes</h1>
    
    <div class="form">
        <input type="hidden" id="clienteId">
        <input type="text" id="nome" placeholder="Nome">
        <input type="email" id="email" placeholder="Email">
        <input type="text" id="telefone" placeholder="Telefone">
        
        <!-- Botão SALVAR - aparece apenas no modo NOVO -->
        <button id="btnSalvar" onclick="salvarNovoCliente()">Salvar</button>
        
        <!-- Botão ATUALIZAR - aparece apenas no modo EDIÇÃO -->
        <button id="btnAtualizar" class="btn-update hidden" onclick="atualizarCliente()">Atualizar</button>
        
        <button onclick="limparForm()" class="btn-cancel">Cancelar</button>
    </div>
    
    <table id="tabela">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Telefone</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Modal -->
    <div id="customModal" class="modal">
        <div class="modal-content">
            <div class="modal-icon" id="modalIcon"></div>
            <div class="modal-header" id="modalHeader"></div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter"></div>
        </div>
    </div>

    <script>
        // Carregar clientes ao abrir a página
        window.onload = carregarClientes;
        
        // ========== FUNÇÕES DO MODAL ==========
        
        function mostrarModal(tipo, titulo, mensagem, callback) {
            const modal = document.getElementById('customModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalHeader = document.getElementById('modalHeader');
            const modalBody = document.getElementById('modalBody');
            const modalFooter = document.getElementById('modalFooter');
            
            // Definir ícone
            const icones = {
                success: '✓',
                error: '✗',
                warning: '⚠',
                question: '?'
            };
            
            modalIcon.innerHTML = icones[tipo] || '!';
            modalIcon.className = 'modal-icon modal-icon-' + tipo;
            
            // Definir título e mensagem
            modalHeader.textContent = titulo;
            modalBody.textContent = mensagem;
            
            // Definir botões
            if (tipo === 'question') {
                // Modal de confirmação (Sim/Não)
                modalFooter.innerHTML = `
                    <button class="modal-btn modal-btn-ok" onclick="fecharModal(true)">Sim</button>
                    <button class="modal-btn modal-btn-cancel" onclick="fecharModal(false)">Não</button>
                `;
                
                // Guardar callback para confirmação
                window.modalCallback = callback;
            } else {
                // Modal de informação (OK)
                modalFooter.innerHTML = `
                    <button class="modal-btn modal-btn-neutral" onclick="fecharModal()">OK</button>
                `;
                window.modalCallback = callback;
            }
            
            modal.style.display = 'block';
        }
        
        function fecharModal(confirmado) {
            const modal = document.getElementById('customModal');
            modal.style.display = 'none';
            
            // Executar callback se existir
            if (window.modalCallback) {
                window.modalCallback(confirmado);
                window.modalCallback = null;
            }
        }
        
        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('customModal');
            if (event.target === modal) {
                fecharModal(false);
            }
        }
        
        // ========== FUNÇÕES DO CRUD ==========
        
        async function carregarClientes() {
            const response = await fetch('/clientes');
            const clientes = await response.json();
            
            const tbody = document.querySelector('#tabela tbody');
            tbody.innerHTML = '';
            
            clientes.forEach(cliente => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cliente.id}</td>
                    <td>${cliente.nome}</td>
                    <td>${cliente.email}</td>
                    <td>${cliente.telefone || ''}</td>
                    <td>
                        <button class="btn-edit" onclick="editarCliente(${cliente.id})">Editar</button>
                        <button class="btn-delete" onclick="confirmarExclusao(${cliente.id})">Excluir</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Função para SALVAR NOVO cliente (POST)
        async function salvarNovoCliente() {
            const cliente = {
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value
            };
            
            // Validação básica
            if (!cliente.nome || !cliente.email) {
                mostrarModal('warning', 'Atenção', 'Preencha Nome e Email!');
                return;
            }
            
            try {
                await fetch('/clientes', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(cliente)
                });
                
                limparForm();
                carregarClientes();
                mostrarModal('success', 'Sucesso', 'Cliente cadastrado com sucesso!');
            } catch (error) {
                mostrarModal('error', 'Erro', 'Erro ao cadastrar cliente!');
            }
        }
        
        // Função para ATUALIZAR cliente existente (PUT)
        async function atualizarCliente() {
            const id = document.getElementById('clienteId').value;
            const cliente = {
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value
            };
            
            // Validação básica
            if (!cliente.nome || !cliente.email) {
                mostrarModal('warning', 'Atenção', 'Preencha Nome e Email!');
                return;
            }
            
            try {
                await fetch(`/clientes/${id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(cliente)
                });
                
                limparForm();
                carregarClientes();
                mostrarModal('success', 'Sucesso', 'Cliente atualizado com sucesso!');
            } catch (error) {
                mostrarModal('error', 'Erro', 'Erro ao atualizar cliente!');
            }
        }
        
        // Função para carregar dados do cliente no formulário (modo EDIÇÃO)
        async function editarCliente(id) {
            const response = await fetch('/clientes');
            const clientes = await response.json();
            const cliente = clientes.find(c => c.id === id);
            
            if (cliente) {
                // Preenche o formulário
                document.getElementById('clienteId').value = cliente.id;
                document.getElementById('nome').value = cliente.nome;
                document.getElementById('email').value = cliente.email;
                document.getElementById('telefone').value = cliente.telefone || '';
                
                // Muda para modo EDIÇÃO
                alternarModoEdicao(true);
            }
        }
        
        // Confirmar exclusão com modal
        function confirmarExclusao(id) {
            mostrarModal(
                'question',
                'Confirmar Exclusão',
                'Tem certeza que deseja excluir este cliente?',
                function(confirmado) {
                    if (confirmado) {
                        excluirCliente(id);
                    }
                }
            );
        }
        
        async function excluirCliente(id) {
            try {
                await fetch(`/clientes/${id}`, {method: 'DELETE'});
                carregarClientes();
                mostrarModal('success', 'Sucesso', 'Cliente excluído com sucesso!');
            } catch (error) {
                mostrarModal('error', 'Erro', 'Erro ao excluir cliente!');
            }
        }
        
        function limparForm() {
            document.getElementById('clienteId').value = '';
            document.getElementById('nome').value = '';
            document.getElementById('email').value = '';
            document.getElementById('telefone').value = '';
            
            // Volta para modo NOVO
            alternarModoEdicao(false);
        }
        
        // Função para alternar entre modo NOVO e modo EDIÇÃO
        function alternarModoEdicao(modoEdicao) {
            const btnSalvar = document.getElementById('btnSalvar');
            const btnAtualizar = document.getElementById('btnAtualizar');
            
            if (modoEdicao) {
                // Modo EDIÇÃO: esconde botão Salvar, mostra botão Atualizar
                btnSalvar.classList.add('hidden');
                btnAtualizar.classList.remove('hidden');
            } else {
                // Modo NOVO: mostra botão Salvar, esconde botão Atualizar
                btnSalvar.classList.remove('hidden');
                btnAtualizar.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
